---
layout: page
title: "Раздел 3 - HTML/HTTP/Формы"
permalink: content-03
---

## Как PHP взаимодействует с HTML
Как следует из названия, HTML - это язык разметки. Это означает, что с помощью HTML мы можем описать только как должна выглядеть веб-страница и что она будет содержать. Т.к. HTML - это не язык программирования, содержимоей этой веб-страницы будет статичным, т.е. не содержать никакой логики, не меняться в зависимости от каких либо условий и так далее.  
Это не является большой проблемой, когда речь идет странице с описанием биографии или просто сайте с обычными информационными статьями.  
Но сделать страничку, которая будет показывать погоду в городе посетителя, к примеру, на HTML уже нельзя.

PHP, в свою очередь, это язык программирования. Мы можем с его помощью реализовать сколь угодно сложные сценарии, наши возможности практически ничем не ограничены. Но в конечном счете, результат работы любого сценария должен быть показан конечному пользователю, а чаще всего это будет веб-страница.  
Есть два варианта "связывания" PHP и HTML:
* PHP сценарии встраиваются прямо внутри HTML тегов
* PHP сценарий сам выводит нужный HTML код

Рассмотрим оба случая.  
Чтобы преобразовать HTML страницу в PHP сценарий достаточно выполнить два шага:
1. Сменить расширение файла с .html на .php
2. Вставить внутрь HTML кода PHP сценарий. Например, это может выглядеть так:

```
<h1>Текущее время: <?php print(date("H:i:s")); ?></h1>
```

В этом примере мы встроили PHP код прямо внутрь HTML и вывели текущее время внутри тега `<h1>`.  
Такой способ интеграции почти всегда предпочтителен, в следующем разделе будет показано почему.

Во втором случае, сценарий будет состоять из PHP кода, который выводит уже подготовленный HTML. Пример:
```
<?php
print("<h1>Текущее время: " . date("H:i:s") . "</h1>");
```
Результат работы обоих примеров будет абсолютно одинаков, но в первом случае наш код легче для восприятия, страница остается по сути HTML кодом с вкраплениями PHP, а значит её легче редактировать и дорабатывать.

## Шаблонизация и понятие шаблонов
Шаблонизация - это процесс разделения нашей программы на две составляющей. Одна часть будет ответственна непосредственно за саму логику сценария, т.е. выполнение вычислений, определение условий и т.д., т.е. основную часть работы, а вторая часть будет должна всего лишь показывать результат работы первой части внутри HTML кода.  

Зачем это нужно? Самое главное преимущество такого подхода - это разделение труда. Т.е. программист, который хорошо знает PHP сможет спокойно работать и даже не задумываться как и каким образом будут показаны результатирующие данные, а с другой стороны, верстальщик, который хорошо знает как оформлять HTML-документы сможет после совсем небольшого обучения, использовать результаты работы PHP программиста.  

Кроме того, если код оформляется по этим стандартам, то его становится намного проще воспринимать, потому что не будет мешанины из PHP и HTML в одном файле.  
Перепишем наш пример, используя технику шаблонизации. В этом случае у нас будет один файл, но в будущих уроках покажем как выделять шаблоны в отдельные файлы.

```
<?php $time = date("H:i:s"); ?>

<h1>Текущее время: <?=$time;?></h1>
```

В этом примере есть одна новая вещь: краткий оператор вывода `?>`. Он заменяет знакомый нам `print` и служит для вывода на экран.

## Протокол HTTP
Как работает WWW (всемирная паутина, веб) в двух словах:
* браузер пользователя (клиент) отсылает на сервер запрос с адресом сайта (URL)
* сервер получает этот запрос и отдает клиенту требуемый тому контент

Иными словами, весь современный веб построен на модели клиент-серверного взаимодействия. И чтобы весь этот процесс оказался возможным, необходим универсальный язык-протокол, который будет понимать и сервер и браузер.  Такой протокол есть, а называется он просто - HTTP.

### Как работает HTTP и зачем нам это знать
Программировать на PHP можно и без знания протокола HTTP, но есть ряд ситуаций, когда для решения определенных задач знание о том, как функционирует сервер, становится просто необходимым. Ведь PHP - это в первую очередь серверный язык программирования.

Протокол HTTP очень прост и состоит, по сути, из двух частей:
* заголовки запроса/ответа
* тело запроса/ответа

Всегда вначале идет список заголовков, затем пустая строка, а затем (если есть) тело запроса/ответа.

И клиент и сервер могут посылать друг другу заголовки и тело, но только в случае с клиентом доступные заголовки будут одни, а с сервером - другие.
Рассмотрим пошагово как будет выглядеть работа по протоколу HTTP в случае, когда пользователь хочет загрузить главную страницу социальной сети "Вконтакте".  

1. Браузер пользователя устанавливает соединение с сервером vk.com и отправляет следующий запрос:

```
GET / HTTP/1.1
Host: vk.com
```

2. Сервер принимает запрос и отправляет ответ:

```
HTTP/1.1 200 OK
Server: Apache  

<html>
<head><title>ВКонтакте</title></head>
<!-- остальной контент страницы ниже -->
```

3. Браузер принимает ответ и показывает готовую страничку

Больше всего нам интересен самый первый шаг, где браузер иницирует запрос в серверу vk.com  
Рассмотрим подробнее что тут происходит:
Самая первая строка этого запроса опредеяет несколько важных параметров, а именно:
* метод, которым будет запрошен контент
* адрес страницы
* версия протокола

`GET` - это метод (глагол) который мы применяем для доступа к указанной странице.   
`GET` является самым часто используемым методом, потому что он говорит серверу о том, что клиент всего лишь хочет прочитать указанный документ. Но помимо `GET` есть и другие методы, а один из них рассмотрим уже в следующем разделе.  

После метода идет указание на адрес страницы - URI (универсальный идентификатор ресурса). В нашем случае мы запрашиваем главную страницу сайта, поэтому используется просто слеш - `/`.  
Последним в этой строке идет версия протокола и почти всегда это будет `HTTP/1.1`  

После строки с указанием основных параметров всегда следует перечисление заголовков, которые передают серверу дополнительную, полезную информацию: название и версия браузера, язык, кодировка, параметры кэширования и т.д.  
Среди всех этих заголовков, которые передаются при каждом запросе, есть один обязательный и самый важный - это заголовок `Host`. Именно он определяет адрес домена, который запрашивает браузер клиента.  

Сервер, в свою очередь, получив запрос ищет у себя сайт с доменом из заголовка `Host`, а также указанную страницу.  
Если запрошенный сайт и страница найдены, клиенту отправляется ответ:  
`HTTP/1.1 200 OK`
Такой ответ означает, что все хорошо, документ найден и будет отправлен клиенту.
Если говорить более обобщенно, стартовая строка ответа имеет следующую структуру:  
`HTTP/Версия Код состояния Пояснение`

Больше всего здесь интересен именно код состояния, он же код ответа сервера.  
 В этом примере код ответа - 200, что означает: сервер работает, документ найден и будет передан клиенту.  Но не всегда все идет гладко.  
 Например, запрошенный документ может отсутствовать или сервер будет перегружен, в таком случае клиент не получит контент, а код ответа будет отличным от 200.  
 * 404 - если сервер доступен, но запрошенный документ не найден
 * 503 - если сервер не может обрабатывать запросы по техническим причинам

Спецификация HTTP 1.1 определяет 40 различных кодов HTTP.  
После стартовой строки следуют заголовки, а также тело ответа.

## Формы
Формы - это часть языка HTML. Формы нужны для передачи любых данных от клиента на сервер. Чаще всего формы используются для регистрации пользователей, заполнения анкет, оформления заказа в интернет магазине и т.д.  
Отправлять можно как простую текстовую информацию, так и целые файлы.  
Большую часть времени программирования на PHP вы будете так или иначе работать с формами и данными из них.  

HTML описывает как выглядит форма: из каких полей и других элементов она состоит, но без принимающей стороны, т.е. сервера, который принимает эти данные и обрабатывает их нужным образом, создавать формы нет никакого смысла.  

PHP содержит множество удобных средств для работы с формами, что позволяет очень просто решать типичные задачи, которые часто возникают в веб-программировании:
 * регистрация и аутентификация пользователя
 * отправка комментариев на форумах и соц. сетях
 * оформление заказов

Практически любой современный сайт содержит как минимум несколько разных форм.

### Отправка формы
Рассмотрим один типичный пример - форма обратной связи. Чтобы дать посетителю сайта возможность связаться с его авторами, как правило используются формы обратной связи, где человек указывает как минимум свое имя, email для обратной связи и сам текст своего сообщения.  
Такая форма может выглядеть в HTML следующим образом:

```
<form name="feedback" method="POST" action="form.php">
<label>Ваше имя: <input type="text" name="name"></label>
<label>Ваш email: <input type="text" name="email"></label>
<label>Сообщение: <textarea name="message"></textarea></label>

<input type="submit" name="send" value="Отправить">
</form>
```

Это очень простая форма, состоящая из трех полей и одной кнопки отправки.  

Почти весь приведенный код описывает внешний вид и содержание формы, но следует обратить внимание на два аттрибута тега `<form>`, которые нужны для указания на способ обработки данных:

* `method` - этот аттрибут используется для определения метода HTTP, который будет использован для передачи данных на сервер. Вы уже знакомы с HTTP методом `GET`, предписывающий серверу просто вернуть определенный документ.  
Метод `POST` наоборот сообщает о намерении передать на сервер некоторую информацию, что, впрочем, не отменяет последующее получение контента.
* `action` - содержит адрес PHP скрипта, который должен обработать эту форму

После нажатия кнопки "отправить" браузер выполняет POST запрос, который содержит введенные данные, на адрес, указанный в аттрибуте `action`.

### Обработка формы

После отправки формы, управление передается php скрипту, который должен получить переданные данные, выполнить с ними какие либо действия (например, сохранить в базе данных) и показать результат.  
Результатом может быть простое сообщение _"ваши данные успешно отправлены"_.  

Поэтому в первую очередь требуется научиться в сценарии получать данные из формы.  
К счастью, в PHP это очень просто - **все данные из формы находятся в глобальном ассоциативном массиве `$_POST`**.  
Этот массив всегда будет неявно присутствовать в сценарии, если он был загружен по методу `POST`.  
Каждое поле из формы будет находиться в массиве, где ключом будет значение аттрибута `name`, а значением содержимое поля.  
Например, чтобы из формы всю информацию на экран, можно написать такой сценарий:

```
<?php
if (isset($_POST)) {
    print("Имя: " . $_POST['name']);
    print("<br>Email: " . $_POST['email']);
    print("<br>Сообщение: " . $_POST['message']);
}

```

Функция `isset` служит для определения существует ли переданная ей переменная. Так мы проверяем, что сценарий загружен методом `POST`, т.е. была отправлена форма.  

Как правило, после обработки формы в PHP, сценарий должен переадресовать пользователя на другую страницу, потому что если форма была отправлена через метод `POST`, то при обновлении страницы пользователем, данные будут отправлены еще раз, а это в большинстве случаев нежелательное поведение.

### Отправка файлов

Помимо текстовой информации, существует возможность отправлять на сервер файлы любых типов.  
Пример формы для загрузки файла:

```
<form name="file_upload" method="POST" action="form.php" enctype="multipart/form-data">
<label>Ваш аватар: <input type="file" name="avatar"></label>
<input type="submit" name="send" value="Отправить файл">
</form>
```

Тут есть два важных отличия от первого примера:
* добавился новый аттрибут `enctype` который всегда должен иметь значение `multipart/form-data`. Если его не будет, то файл просто не отправится.
* сам файл загружается при помощи поля с типом "file"

В PHP загруженный файл будет доступен в другом специальном массиве - `$_FILES`.  
```
<?php
if (isset($_FILES['avatar'])) {
    $file = $_FILES['avatar'];

    print("Загружен файл с именем " . $file['name'] . " и размером " . $file['size'] . " байт");
}
```